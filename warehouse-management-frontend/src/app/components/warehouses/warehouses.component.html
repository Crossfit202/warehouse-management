<div class="content">
    <h1>Warehouses</h1>

    <div class="d-flex justify-content-start mb-3">
        <button class="btn btn-success" (click)="openAddModal()">Add Warehouse</button>
    </div>

    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th></th>
                <th>Name</th>
                <th>Location</th>
                <th>Max Capacity</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <ng-container *ngFor="let warehouse of warehouses">
                <tr>
                    <td>
                        <button class="btn btn-link p-0" (click)="toggleExpand(warehouse)">
                            <span *ngIf="expandedWarehouseId !== warehouse.id">▶️</span>
                            <span *ngIf="expandedWarehouseId === warehouse.id">▼</span>
                        </button>
                    </td>
                    <td>{{ warehouse.name }}</td>
                    <td>{{ warehouse.location }}</td>
                    <td>{{ warehouse.max_capacity }}</td>
                    <td>
                        <button class="btn btn-primary btn-sm me-2" (click)="openEditModal(warehouse)">Edit</button>
                        <button class="btn btn-danger btn-sm" (click)="openDeleteModal(warehouse)">Delete</button>
                    </td>
                </tr>
                <tr *ngIf="expandedWarehouseId === warehouse.id">
                    <td colspan="5" style="background: #f9f9f9;">
                        <div *ngIf="storageLocations[warehouse.id]; else loading">
                            <strong>Storage Locations:</strong>
                            <ul *ngIf="storageLocations[warehouse.id].length > 0; else noLocations">
                                <li *ngFor="let loc of storageLocations[warehouse.id]">
                                    <strong>{{ loc.name }}</strong>
                                    <ul>
                                        <li>Name: {{ loc.name }}</li>
                                        <li>Max Capacity: {{ loc.max_capacity }}</li>
                                    </ul>
                                </li>
                            </ul>
                            <ng-template #noLocations>
                                <em> No storage locations found.</em>
                            </ng-template>
                        </div>
                        <ng-template #loading>
                            <em>Loading storage locations...</em>
                        </ng-template>
                    </td>
                </tr>
            </ng-container>
        </tbody>
    </table>

    <!-- Add Modal -->
    <div *ngIf="showAddModal" class="modal">
        <div class="modal-content">
            <h3>Add Warehouse</h3>
            <label>Name</label>
            <input type="text" [(ngModel)]="newWarehouse.name" class="form-control" />
            <label>Location</label>
            <input type="text" [(ngModel)]="newWarehouse.location" class="form-control" />
            <label>Max Capacity</label>
            <input type="number" [(ngModel)]="newWarehouse.max_capacity" class="form-control" min="1" />
            <div class="modal-actions mt-3">
                <button class="btn btn-success" (click)="addWarehouse()">Add</button>
                <button class="btn btn-secondary" (click)="closeAddModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div *ngIf="showEditModal" class="modal">
        <div class="modal-content" *ngIf="editWarehouse">
            <h3>Edit Warehouse</h3>
            <div>Modal is open!</div>
            <label>Name</label>
            <input type="text" [(ngModel)]="editWarehouse.name" class="form-control" />
            <label>Location</label>
            <input type="text" [(ngModel)]="editWarehouse.location" class="form-control" />
            <label>Max Capacity</label>
            <input type="number" [(ngModel)]="editWarehouse.max_capacity" class="form-control" min="1" />
            <div class="modal-actions mt-3">
                <button class="btn btn-primary" (click)="updateWarehouse()">Save</button>
                <button class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div *ngIf="showDeleteModal" class="modal">
        <div class="modal-content" *ngIf="deleteWarehouse">
            <h3>Delete Warehouse</h3>
            <p>Are you sure you want to delete <strong>{{ deleteWarehouse.name }}</strong>?</p>
            <div class="modal-actions mt-3">
                <button class="btn btn-danger" (click)="deleteWarehouseConfirmed()">Delete</button>
                <button class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
            </div>
        </div>
    </div>
</div>